plugins {
    id 'java'
    id 'org.jetbrains.intellij' version '0.3.5'
    id "org.jetbrains.grammarkit" version "2018.1.7"
    id 'checkstyle'

}
group 'net.sjrx.intellij.plugins'
version '0.1-SNAPSHOT'

sourceCompatibility = 1.8

repositories {
    mavenCentral()
}

dependencies {
    testCompile group: 'junit', name: 'junit', version: '4.12'
}

intellij {
    version '2018.2'
}
patchPluginXml {
    changeNotes """
      Add change notes here.<br>
      <em>most HTML tags may be used</em>"""
}

// Add generated sources root
sourceSets.main.java.srcDirs += 'src/main/gen'

checkstyle {
  // Exclude the generated sources
  checkstyleMain.source = "src/main/java"
  toolVersion "8.11"

}


apply plugin: 'org.jetbrains.grammarkit'
// import is optional to make task creation easier
import org.jetbrains.grammarkit.tasks.*

task generateLexer(type: GenerateLexer) {
  source = "src/main/resources/net/sjrx/intellij/plugins/systemdunitfiles/lexer/SystemdUnitFile.flex"
  targetDir = "src/main/gen/net/sjrx/intellij/plugins/systemdunitfiles/generated/"
  targetClass = "UnitFileLexer"
  purgeOldFiles = true
}

task generateParser(type: GenerateParser) {
  source = "src/main/resources/net/sjrx/intellij/plugins/systemdunitfiles/grammar/SystemdUnitFile.bnf"
  targetRoot = "src/main/gen/"

  // path to a parser file, relative to the targetRoot
  pathToParser = 'src/main/gen/net/sjrx/intellij/plugins/systemdunitfiles/generated/UnitFileParser.java'

  // path to a directory with generated psi files, relative to the targetRoot
  pathToPsiRoot = 'src/main/gen/net/sjrx/intellij/plugins/systemdunitfiles/psi/'

  purgeOldFiles = true

  dependsOn generateLexer
}

compileJava.dependsOn += generateParser
